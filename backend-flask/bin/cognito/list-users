#!/usr/bin/env python3

import boto3
import os, json

userpool_id = os.getenv("AWS_COGNITO_USER_POOL_ID")
client = boto3.client("cognito-idp")
params = {
	'UserPoolId': userpool_id,
	'AttributesToGet': [
		'preferred_username',
		'sub'
	]
}
response = client.list_users(**params)
users = response['Users']

print(json.dumps(users, sort_keys=True, indent=2, default=str))

dict_users = {}
for user in users:
	attrs = user['Attributes']
	sub = next((a for a in attrs if a["Name"] == 'sub'), None)
	sub = next((a for a in attrs if a["Name"] == 'sub'), None)

print(json.dumps(users, sort_keys=True, indent=2, default=str))