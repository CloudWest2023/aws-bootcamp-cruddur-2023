#!/usr/bin/env python3

import boto3
import sys
import os

aws_endpoint_url = os.getenv("AWS_ENDPOINT_URL")
attrs = {
            'endpoint_url': aws_endpoint_url
        }


if len(sys.argv) == 2:
    if "prod" in sys.argv[1]:
        attrs = {}


dynamodb = boto3.client('dynamodb', **attrs) 
table_name = 'cruddur-messages-on-cloud'


response = dynamodb.create_table(
    TableName = table_name,

    # 'S'|'N'|'B'    # String | Number | Binary
    AttributeDefinitions = [
        {
            'AttributeName': 'message_group_uuid',
            'AttributeType': 'S' 
        },
        {
            'AttributeName': 'pk',
            'AttributeType': 'S' 
        },
        {
            'AttributeName': 'sk',
            'AttributeType': 'S' 
        },
    ],

    # 'HASH'|'RANGE'
    KeySchema = [
        {
            'AttributeName': 'pk',
            'KeyType': 'HASH'
        },
        {
            'AttributeName': 'sk',
            'KeyType': 'RANGE'
        },
    ],
    'GlobalSecondaryIndexes': [{
        'IndexName': 'message-group-sk-index',
        'KeySchema': [{
            'AttributeName': 'message_group_uuid',
            'KeyType': 'HASH'
        }, {
            'AttributeName': 'sk',
            'KeyType': 'RANGE'                   
        }],
        'Projection': {
            'ProjectionType': 'ALL'
        },
        'ProvisionedThroughput': {
            'ReadCapacityUnits': 5,
            'WriteCapacityUnits': 5
        }
    }], 
    BillingMode = 'PROVISIONED',
    ProvisionedThroughput = {
        'ReadCapacityUnits': 5,
        'WriteCapacityUnits': 5
    },
)

print(response)